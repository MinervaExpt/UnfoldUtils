package Ana/UnfoldUtils
version ${MINERVA_RELEASE}

branches cmt RooUnfold MinervaUnfold

#==============================================================================

use Boost         v* LCG_Interfaces
use Reflex        v* LCG_Interfaces
use RELAX         v* LCG_Interfaces
use ROOT          v* LCG_Interfaces

# We don't directly need GSL, but RooFit depends on libMathMore from
# ROOT, which does. Somehow the packages that *actually* directly
# depends on GSL isn't specifying it in its requirements file. I guess
# that's what you get for using ancient versions of things

use GSL           *  LCG_Interfaces

use GaudiPolicy   v* Gaudi       # needed for 'merge_rootmap' command, C++ compilation options, some other stuff

use PlotUtils         v*   Ana

#==============================================================================

set RooUnfold "${UNFOLDUTILSDROOT}/RooUnfold"

include_dirs $(UNFOLDUTILSROOT)

#add the library location to LD_LIBRARY_PATH so we can build against libRooUnfold.so/libUnfoldUtils.so
path_append LD_LIBRARY_PATH "${UNFOLDUTILSROOT}/${CMTCONFIG}"

## NOTE: this requirements file uses many of the same hacks
##       used in the requirements file for Ana/Plotutils.
##       please see the comments there if you would like
##       to understand the evil black magic that transpires below.

# build a Reflex dictionary to make the types available to PyROOT
macro_append gccxml_cppflags " --rootmap-lib=libUnfoldUtils "
apply_pattern reflex_dictionary_src \   
              dictionary=UnfoldUtils \
              headerfiles=$(UNFOLDUTILSROOT)/dict/UnfoldUtilsDict.h \   
              selectionfile=$(UNFOLDUTILSROOT)/dict/UnfoldUtilsDict.xml

private

# build the library, which includes:
#  (1) dictionary entries generated by Reflex (above)
#  (2) RooFit objects
#  (3) MinervaUnfold objects
macro_append shlibflags " `root-config --glibs` -L$(PLOTUTILSROOT)/$(tag) -lReflex -lCintex -lRooFit -lplotutils -Wl,--no-undefined"
library UnfoldUtils "-s=../RooUnfold" *.cxx "-s=../$(tag)/dict/UnfoldUtils" *.cpp "-s=../MinervaUnfold" *.cxx
apply_pattern linker_library library=UnfoldUtils

# also install the Python wrapper to InstallArea
apply_pattern install_python_modules
